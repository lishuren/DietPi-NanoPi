<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>DietPi Portal</title>
  <style>
      .statusbar { display:grid; grid-template-columns: repeat(auto-fit, minmax(160px, 1fr)); gap:12px; margin: 18px 0 26px; }
      .tile { background: rgba(255,255,255,0.06); border: 1px solid rgba(255,255,255,0.08); border-radius: 10px; padding: 12px; }
      .tile h3 { margin: 0 0 8px; font-size: 0.95rem; color: var(--muted); }
      .meter { height: 8px; border-radius: 6px; background: rgba(255,255,255,0.12); overflow: hidden; }
      .meter > span { display:block; height:100%; background: linear-gradient(90deg, var(--accent), #60a5fa); }
      .small { font-size: 0.9rem; color: var(--muted); }
    :root { --bg:#0f172a; --card:#1e293b; --text:#e2e8f0; --muted:#94a3b8; --accent:#38bdf8; --accent2:#22c55e; --accent3:#f59e0b; }
    * { box-sizing: border-box; }
    body { margin:0; font-family: system-ui, -apple-system, Segoe UI, Roboto, Ubuntu, Cantarell, 'Helvetica Neue', Arial, 'Noto Sans', 'Apple Color Emoji','Segoe UI Emoji','Segoe UI Symbol'; background: linear-gradient(120deg,#0b1224,#0f172a 40%,#0b1224); color: var(--text); }
    .wrap { max-width: 1024; margin: 0 auto; padding: 40px 20px; }
    header { text-align: center; margin-bottom: 24px; }
    header h1 { margin:0; font-size: 2rem; letter-spacing: 0.4px; }
    header p { color: var(--muted); margin-top: 8px; }
    .grid { display: grid; grid-template-columns: repeat(2, minmax(270px, 1fr)); gap: 18px; }
    @media (max-width: 640px) { .grid { grid-template-columns: 1fr; } }
    .card { background: linear-gradient(180deg, rgba(255,255,255,0.06), rgba(255,255,255,0.02)); border: 1px solid rgba(255,255,255,0.08); backdrop-filter: blur(4px); border-radius: 12px; padding: 20px; transition: box-shadow 120ms ease; }
    .card:hover { box-shadow: 0 6px 20px rgba(0,0,0,0.25); }
    .card h2 { margin: 0 0 8px; font-size: 1.1rem; }
    .card p { margin: 0 0 12px; color: var(--muted); font-size: 0.95rem; }
    .btn { display: inline-block; padding: 10px 14px; border-radius: 8px; text-decoration: none; color: #0b1224; font-weight: 600; background: var(--accent); transition: background 0.15s; }
    .btn.secondary { background: var(--accent2); color: #fff; }
    .btn.warn { background: var(--accent3); color: #fff; }
    .btn.open-url { background: #6366f1; color: #fff; } /* Indigo */
    .btn.copy { background: #f472b6; color: #fff; } /* Pink */
    /* Unified, elegant button style for all buttons */
    .btn, button, input[type="button"], input[type="submit"] {
      display: inline-block;
      background: linear-gradient(90deg, #4f8cff 0%, #6f6fff 100%);
      color: #fff !important;
      border: none;
      border-radius: 0.5em;
      padding: 0.55em 1.5em;
      font-size: 1em;
      font-family: inherit;
      font-weight: 500;
      box-shadow: 0 1px 6px 0 rgba(79,140,255,0.10);
      transition: background 0.18s, transform 0.10s, box-shadow 0.18s;
      cursor: pointer;
      outline: none;
      min-height: 36px;
      min-width: 100px;
      margin: 0.25em 0.15em;
      letter-spacing: 0.01em;
      text-decoration: none;
      line-height: 1.1;
    }
    .btn:hover, button:hover, input[type="button"]:hover, input[type="submit"]:hover {
      background: linear-gradient(90deg, #6f6fff 0%, #4f8cff 100%);
      transform: translateY(-1px) scale(1.03);
      box-shadow: 0 2px 10px 0 rgba(79,140,255,0.18);
    }
    .btn:active, button:active, input[type="button"]:active, input[type="submit"]:active {
      background: linear-gradient(90deg, #3a6fd8 0%, #4f8cff 100%);
      transform: scale(0.98);
    }
    /* Destructive (danger) button: Clear Logs */
    .btn-danger, .btn.warn, .clear-logs-btn {
      background: linear-gradient(90deg, #ff4f6f 0%, #ff6f6f 100%) !important;
      color: #fff !important;
    }
    .btn-danger:hover, .btn.warn:hover, .clear-logs-btn:hover {
      background: linear-gradient(90deg, #ff6f6f 0%, #ff4f6f 100%) !important;
    }
    .btn-danger:active, .btn.warn:active, .clear-logs-btn:active {
      background: linear-gradient(90deg, #d83a5c 0%, #ff4f6f 100%) !important;
    }
    /* GitHub button: always white */
    .btn.github {
      background: #fff !important;
      color: #222 !important;
      border: 1px solid #e5e7eb;
      box-shadow: 0 1px 4px rgba(0,0,0,0.04);
    }
    .btn.github:hover {
      background: #f1f5f9 !important;
      color: #222 !important;
    }
    /* Remove color/height differences for other special buttons */
    .btn.copy, .copy-btn, .btn-copy, .btn.open-url, .btn.secondary {
      background: linear-gradient(90deg, #4f8cff 0%, #6f6fff 100%) !important;
      color: #fff !important;
      font-weight: 500;
      border: none;
      box-shadow: 0 1px 6px 0 rgba(79,140,255,0.10);
    }
    .btn.copy:hover, .copy-btn:hover, .btn-copy:hover, .btn.open-url:hover, .btn.secondary:hover {
      background: linear-gradient(90deg, #6f6fff 0%, #4f8cff 100%) !important;
    }
    .btn.copy:active, .copy-btn:active, .btn-copy:active, .btn.open-url:active, .btn.secondary:active {
      background: linear-gradient(90deg, #3a6fd8 0%, #4f8cff 100%) !important;
    }
    /* Ensure all buttons have consistent height in cards */
    .card button, .card .btn, .card input[type="button"], .card input[type="submit"] {
      min-height: 36px;
      min-width: 100px;
      font-size: 1em;
    }

    /* System version (red box) styling */
    #systemVersion {
      font-size: 0.93rem;
      font-family: ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, 'Liberation Mono', 'Courier New', monospace;
      background: rgba(15,23,42,0.10);
      border-radius: 6px;
      padding: 6px 8px;
      margin-top: 6px;
      color: var(--text);
      word-break: break-all;
      white-space: pre-line;
      max-width: 100%;
      line-height: 1.5;
    }

    /* Align log-to-ram label (green box) */
    .log-tmpfs-label {
      font-size: 1rem;
      color: var(--text);
      margin-left: 6px;
      margin-right: 6px;
      vertical-align: middle;
      font-weight: 500;
      min-width: 120px;
      display: inline-block;
    }
    .btn:hover { filter: brightness(1.08); }
    .icon { width: 20px; height: 20px; fill: currentColor; }
    .row { display: flex; gap: 10px; flex-wrap: wrap; }
    .mono { font-family: ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, 'Liberation Mono', 'Courier New', monospace; background: rgba(15,23,42,0.6); border: 1px solid rgba(255,255,255,0.08); border-radius: 8px; padding: 10px; }
    footer { margin-top: 28px; text-align: center; color: var(--muted); font-size: 0.9rem; }
    
    /* Toggle Switch */
    .switch { position: relative; display: inline-block; width: 48px; height: 24px; vertical-align: middle; }
    .switch input { opacity: 0; width: 0; height: 0; }
    .slider { position: absolute; cursor: pointer; top: 0; left: 0; right: 0; bottom: 0; background-color: #334155; transition: .4s; border-radius: 24px; }
    .slider:before { position: absolute; content: ""; height: 18px; width: 18px; left: 3px; bottom: 3px; background-color: white; transition: .4s; border-radius: 50%; }
    input:checked + .slider { background-color: var(--accent2); }
    input:checked + .slider:before { transform: translateX(24px); }
    input:disabled + .slider { opacity: 0.5; cursor: not-allowed; }
  </style>
  <script>
    const host = window.location.hostname;
    function smbPath() {
      return "\\\\" + host + "\\downloads";
    }
    function copySmb() {
      const path = smbPath();
      // Fallback for non-HTTPS contexts
      if (!navigator.clipboard) {
        const textArea = document.createElement("textarea");
        textArea.value = path;
        textArea.style.position = "fixed"; // Avoid scrolling to bottom
        document.body.appendChild(textArea);
        textArea.focus();
        textArea.select();
        try {
          document.execCommand('copy');
          const el = document.getElementById('copyStatus');
          el.textContent = 'Copied! Use Win+R ‚Üí paste to open.';
          setTimeout(() => el.textContent = '', 2500);
        } catch (err) {
          alert('Copy failed. Path: ' + path);
        }
        document.body.removeChild(textArea);
        return;
      }
      
      navigator.clipboard.writeText(path).then(() => {
        const el = document.getElementById('copyStatus');
        el.textContent = 'Copied! Use Win+R ‚Üí paste to open.';
        setTimeout(() => el.textContent = '', 2500);
      }).catch(() => {
        alert('Copy failed. Path: ' + path);
      });
    }
    
    function handleProxyOpen(e) {
      e.preventDefault();
      const input = document.getElementById('proxyUrlInput');
      const url = input.value.trim();
      if (!url) return false;
      // Open /proxy/?q=URL in a new tab
      window.open('/proxy/?q=' + encodeURIComponent(url), '_blank');
      return false;
    }
    
    async function toggleVpn(e) {
        const isOn = e.target.checked;
        const statusEl = document.getElementById('vpnStat');
        statusEl.textContent = 'Switching...';
        e.target.disabled = true;
        
        try {
            const res = await fetch('/api/vpn_control.php', {
                method: 'POST',
                headers: {'Content-Type': 'application/json'},
                body: JSON.stringify({action: isOn ? 'on' : 'off'})
            });
            const data = await res.json();
            if(!data.success) {
                alert('Error: ' + data.message);
                e.target.checked = !isOn; // Revert
            }
        } catch(err) {
            alert('Network error');
            e.target.checked = !isOn;
        } finally {
            e.target.disabled = false;
            // Poll will update status shortly
        }
    }

    async function updateSystem() {
      const btn = document.getElementById('updateSystemBtn');
      const status = document.getElementById('updateStatus');
      const versionDiv = document.getElementById('systemVersion');
      btn.disabled = true;
      status.textContent = 'Updating...';
      let before = '';
      try {
        const v1 = await fetch('/api/system_update.php', {method:'POST', headers:{'Content-Type':'application/json'}, body:JSON.stringify({action:'version'})});
        const v1j = await v1.json();
        before = v1j.version || '';
        versionDiv.textContent = 'Before: ' + before;
        const res = await fetch('/api/system_update.php', {method:'POST', headers:{'Content-Type':'application/json'}, body:JSON.stringify({action:'update'})});
        const data = await res.json();
        status.textContent = data.success ? 'Updated!' : 'Update failed.';
        versionDiv.textContent = `Before: ${before}\nAfter: ${data.after}`;
      } catch(e) {
        status.textContent = 'Error running update.';
      }
      btn.disabled = false;
    }

    async function toggleLogTmpfs(e) {
      const toggle = document.getElementById('logTmpfsToggle');
      const status = document.getElementById('logTmpfsStatus');
      toggle.disabled = true;
      status.textContent = 'Applying...';
      try {
        const action = toggle.checked ? 'enable' : 'disable';
        const res = await fetch('/api/log_tmpfs.php', {method:'POST', headers:{'Content-Type':'application/json'}, body:JSON.stringify({action})});
        const data = await res.json();
        status.textContent = data.success ? (toggle.checked ? 'Logs now in RAM.' : 'Logs now on disk.') : 'Failed.';
      } catch(e) {
        status.textContent = 'Error.';
      }
      toggle.disabled = false;
    }

    async function clearLogs() {
      const btn = document.getElementById('clearLogsBtn');
      const status = document.getElementById('clearLogsStatus');
      btn.disabled = true;
      status.textContent = 'Clearing...';
      try {
        const res = await fetch('/api/clear_logs.php', {method:'POST', headers:{'Content-Type':'application/json'}, body:JSON.stringify({action:'clear'})});
        const data = await res.json();
        status.textContent = data.success ? 'Logs cleared.' : 'Failed.';
      } catch(e) {
        status.textContent = 'Error.';
      }
      btn.disabled = false;
    }

    async function pollLogTmpfs() {
      try {
        const res = await fetch('/api/log_tmpfs.php', {method:'POST', headers:{'Content-Type':'application/json'}, body:JSON.stringify({action:'status'})});
        const data = await res.json();
        document.getElementById('logTmpfsToggle').checked = !!data.tmpfs;
      } catch(e) {}
    }

    async function pollSystemVersion() {
      try {
        const versionDiv = document.getElementById('systemVersion');
        const v1 = await fetch('/api/system_update.php', {method:'POST', headers:{'Content-Type':'application/json'}, body:JSON.stringify({action:'version'})});
        const v1j = await v1.json();
        // v1j.version may be a string or array, handle both
        let versionText = '';
        if (Array.isArray(v1j.version)) {
          // Remove lines containing HOME_URL, SUPPORT_URL, or BUG_REPORT_URL
          versionText = v1j.version
            .filter(line => !/HOME_URL=|SUPPORT_URL=|BUG_REPORT_URL=/.test(line))
            .join(' ');
        } else {
          versionText = (v1j.version || '').split(/\n|\r|;/)
            .filter(line => !/HOME_URL=|SUPPORT_URL=|BUG_REPORT_URL=/.test(line))
            .join(' ');
        }
        versionDiv.textContent = 'Current: ' + versionText;
      } catch(e) {}
    }

    async function pollProjectVersion() {
      try {
          const res = await fetch('/project-version.txt');
        const txt = await res.text();
        document.getElementById('projectVersion').textContent = 'Portal Version: ' + txt.trim();
      } catch(e) {}
    }

    document.addEventListener('DOMContentLoaded', () => {
      const hostEl = document.getElementById('deviceHost');
      if (hostEl) hostEl.textContent = host;
      document.getElementById('smbPath').textContent = smbPath();

      // Poll endpoints
      const fmtBytes = (b) => {
        if (b == null) return '‚Äî';
        const u = ['B','KB','MB','GB','TB'];
        let i = 0; let v = b;
        while (v >= 1024 && i < u.length-1) { v /= 1024; i++; }
        return v.toFixed(v>=100?0: v>=10?1:2) + ' ' + u[i];
      };
      const byps = (b)=> (b==null? '‚Äî' : ( (b/1024).toFixed(b>=1024*100?0:1) + ' KB/s'));

      function renderSystem(s){
        const load = s?.cpu?.load1 ?? 0;
        const load5 = s?.cpu?.load5 ?? 0;
        const load15 = s?.cpu?.load15 ?? 0;
        const memT = s?.mem?.total ?? 0;
        const memU = s?.mem?.used ?? 0;
        const memPct = memT? Math.min(100, Math.round((memU/memT)*100)) : 0;
        const temp = s?.temp;
        const uptime = s?.uptime;
        const cpuModel = s?.cpu_model;

        document.getElementById('cpuLoad').style.width = Math.min(100, load*25) + '%';
        const cpuText = document.getElementById('cpuText');
        if(cpuText) {
            cpuText.textContent = `${load} / ${load5} / ${load15}`;
            if(cpuModel) cpuText.title = cpuModel;
        }

        document.getElementById('memBar').style.width = memPct + '%';
        const memText = document.getElementById('memText');
        if(memText) memText.textContent = `${fmtBytes(memU)} / ${fmtBytes(memT)}`;

        const tempEl = document.getElementById('tempVal');
        if(tempEl) tempEl.textContent = (temp!=null? (temp+' ¬∞C') : '‚Äî');

        const upEl = document.getElementById('uptimeText');
        if(upEl && uptime) {
            const d = Math.floor(uptime / 86400);
            const h = Math.floor((uptime % 86400) / 3600);
            const m = Math.floor((uptime % 3600) / 60);
            let upStr = '';
            if(d>0) upStr += d + 'd ';
            if(h>0) upStr += h + 'h ';
            upStr += m + 'm';
            upEl.textContent = 'Up: ' + upStr;
        }
      }
      function renderMount(m){
        // Root (TF Card)
        const r = m?.root;
        if(r) {
            const total=r.totalBytes, free=r.freeBytes, used=r.usedBytes;
            const pct = total? Math.min(100, Math.round((used/total)*100)) : 0;
            const bar = document.getElementById('rootBar');
            if(bar) bar.style.width = pct + '%';
            const txt = document.getElementById('rootText');
            if(txt) txt.textContent = `${fmtBytes(free)} free of ${fmtBytes(total)}`;
        }

        // USB
        const u = m?.usb;
        if(u) {
            const total=u.totalBytes, free=u.freeBytes, used=u.usedBytes;
            const pct = (u.mounted && total)? Math.min(100, Math.round((used/total)*100)) : 0;
            document.getElementById('diskBar').style.width = pct + '%';
            const diskText = document.getElementById('diskText');
            if(diskText) {
                 if(u.mounted) {
                    diskText.textContent = `${fmtBytes(free)} free of ${fmtBytes(total)}`;
                 } else {
                    diskText.textContent = 'Not Mounted';
                 }
            }
        }
      }
      function renderServices(sv){
        const list = sv?.services || [];
        const aria = list.find(x=>x.name==='aria2');
        const mihomo = list.find(x=>x.name==='mihomo');
        document.getElementById('ariaStat').textContent = aria?.active? 'running' : 'stopped';
      }
      function renderAria2(a){
        const g=a?.global;
        document.getElementById('ariaSpeed').textContent = `${byps(g?.downloadSpeed)} down / ${byps(g?.uploadSpeed)} up`;
        document.getElementById('ariaCounts').textContent = `Active ${g?.numActive??'‚Äî'}, Waiting ${g?.numWaiting??'‚Äî'}`;
      }
      function renderVpnTraffic(t){
        const up = t?.up ?? 0;
        const down = t?.down ?? 0;
        document.getElementById('vpnSpeed').textContent = `‚Üë ${byps(up)}  ‚Üì ${byps(down)}`;
      }
      
      async function poll(){
        try{ const r=await fetch('/api/system.php'); renderSystem(await r.json()); }catch(e){}
        try{ const r=await fetch('/api/mount.php'); renderMount(await r.json()); }catch(e){}
        try{ const r=await fetch('/api/services.php'); renderServices(await r.json()); }catch(e){}
        try{ const r=await fetch('/api/aria2.php'); renderAria2(await r.json()); }catch(e){}

        // Fetch VPN status and update vpnStat and toggle
        try {
          const res = await fetch('/api/clash.php?action=status');
          const data = await res.json();
          const vpnStat = document.getElementById('vpnStat');
          const vpnMsg = document.getElementById('vpnMsg');
          const vpnIP = document.getElementById('vpnIP');
          const vpnToggle = document.getElementById('vpnToggle');
          if (vpnToggle) vpnToggle.checked = !!data.vpn_on;
          if (vpnStat) {
            if (data.vpn_on) {
              vpnStat.textContent = data.current_proxy || 'Proxy';
              vpnStat.style.color = 'var(--accent2)';
            } else {
              vpnStat.textContent = 'Direct';
              vpnStat.style.color = 'var(--muted)';
            }
          }
          if (vpnIP) {
            vpnIP.textContent = data.proxy_ip || '‚Äî';
          }
          if (vpnMsg) {
            let msg = '';
            msg += `<b>Proxy IP:</b> ${data.proxy_ip || '‚Äî'}<br/>`;
            msg += `<b>Direct IP:</b> ${data.direct_ip || '‚Äî'}<br/>`;
            msg += `<b>Current Proxy:</b> ${data.current_proxy || '‚Äî'}<br/>`;
            if (data.provider) {
              msg += `<b>Provider:</b> ${data.provider.name || '‚Äî'}<br/>`;
              msg += `<b>Updated:</b> ${data.provider.updated || '‚Äî'}<br/>`;
              if (data.provider.info) {
                const info = data.provider.info;
                const fmt = b => b == null ? '‚Äî' : (b/1024/1024/1024).toFixed(2) + ' GB';
                msg += `<b>Usage:</b> ${fmt(info.Upload + info.Download)} / ${fmt(info.Total)}<br/>`;
                if (info.Expire) {
                  const d = new Date(info.Expire * 1000);
                  msg += `<b>Expire:</b> ${d.toLocaleDateString()}<br/>`;
                }
              }
            }
            vpnMsg.innerHTML = msg;
          }
        } catch(e) {}

        // Always show traffic in the card
        try {
          const r = await fetch('/api/clash.php?action=traffic');
          const t = await r.json();
          const vpnTraffic = document.getElementById('vpnTraffic');
          const byps = b => (b==null? '‚Äî' : ((b/1024).toFixed(b>=1024*100?0:1) + ' KB/s'));
          if (vpnTraffic) {
            vpnTraffic.textContent = `‚Üë ${byps(t.up)} ‚Üì ${byps(t.down)}`;
          }
        } catch(e) {
          const vpnTraffic = document.getElementById('vpnTraffic');
          if (vpnTraffic) vpnTraffic.textContent = '‚Äî';
        }
      }
      poll(); setInterval(poll, 3000);
      pollLogTmpfs();
      pollSystemVersion();
      pollProjectVersion();
    });
  </script>
  <link rel="icon" href="data:,">
  <!-- Edit this file and redeploy via scripts/install_home_page.sh -->
</head>
<body>
  <div class="wrap">
    <header>
      <h1>DietPi Portal</h1>
      <p>Jump quickly to services hosted on this box.</p>
      <p style="color: var(--muted);">Device Address: <span class="mono" id="deviceHost">loading...</span></p>
      <div class="statusbar">
        <div class="tile">
          <h3>CPU Load</h3>
          <div class="meter"><span id="cpuLoad" style="width:0%"></span></div>
          <div class="small" style="margin-top:6px" id="cpuText">1‚Äëmin average</div>
        </div>
        <div class="tile">
          <h3>Memory</h3>
          <div class="meter"><span id="memBar" style="width:0%"></span></div>
          <div class="small" style="margin-top:6px" id="memText">Used</div>
        </div>
        <div class="tile">
          <h3>TF Card</h3>
          <div class="meter"><span id="rootBar" style="width:0%"></span></div>
          <div class="small" style="margin-top:6px" id="rootText">‚Äî</div>
        </div>
        <div class="tile">
          <h3>USB Disk</h3>
          <div class="meter"><span id="diskBar" style="width:0%"></span></div>
          <div class="small" style="margin-top:6px" id="diskText">‚Äî</div>
        </div>
        <div class="tile">
          <h3>Temperature</h3>
          <div style="font-size:1.5rem; font-weight:bold; margin-bottom:4px" id="tempVal">‚Äî</div>
          <div class="small" id="uptimeText">Uptime: ‚Äî</div>
        </div>
      </div>
    </header>

    <section class="grid">
      <div class="card">
        <h2>Aria2 Web UI</h2>
        <p>Default Web UI for Aria2 downloads.</p>
        <a class="btn" href="/aria2/" rel="noopener">Open Aria2 UI</a>
        <p class="small">Speed: <span id="ariaSpeed">‚Äî</span></p>
        <p class="small">Jobs: <span id="ariaCounts">‚Äî</span></p>
      </div>

       <div class="card">
          <h2>VPN Control</h2>
          <p>Toggle VPN (VPN-Switch: Proxy/DIRECT), view current public IP and traffic, and open MetaCubeX Dashboard.</p>
          <div style="margin-bottom:10px; display: flex; align-items: center; gap: 16px; flex-wrap: wrap;">
            <span id="vpnStat" style="font-weight:700; font-size:1.1rem; color:var(--accent2); min-width:120px; max-width:140px; overflow:hidden; text-overflow:ellipsis; white-space:nowrap; display:inline-block; vertical-align:middle; cursor:help;" title="‚Äî">‚Äî</span>
            <label class="switch">
              <input type="checkbox" id="vpnToggle" onchange="toggleVpn(event)"/>
              <span class="slider"></span>
            </label>
            <a class="btn secondary" href="/metacubexd/" rel="noopener" target="_blank" style="margin-left:8px;">Open MetaCubeX</a>
          </div>
          <div style="display:flex; align-items:center; gap:18px; margin-bottom:6px;">
            <span style="font-size:1rem;">IP: <span id="vpnIP">‚Äî</span></span>
            <span id="vpnTraffic" style="font-size:1rem; color:var(--muted)">‚Äî</span>
          </div>
          <div class="small" id="vpnMsg" style="margin-top:2px; color:var(--muted)"></div>
       </div>

      <div class="card">
        <h2>PHP-Proxy</h2>
        <div style="border-radius:8px; padding:18px 16px 14px 16px; display:flex; align-items:center; justify-content:center; flex-direction:column; background: linear-gradient(180deg, rgba(255,255,255,0.06), rgba(255,255,255,0.02)); border: 1px solid rgba(255,255,255,0.08);">
          <form action="/proxy/" method="get" style="width:100%; max-width:480px; display:flex; flex-direction:column; align-items:stretch; gap:6px;" onsubmit="return handleProxyOpen(event)">
            <input type="text" id="proxyUrlInput" name="q" placeholder="http://" style="padding:4px 8px; border:1px solid #ccc; border-radius:4px; font-size:0.97rem; height:28px; margin-bottom:0;" />
            <button type="submit" class="btn open-url" style="margin-top:4px; padding:7px 0; border:none; border-radius:4px; font-size:1rem; cursor:pointer;">Open</button>
          </form>
          <div style="margin-top:10px; color:#bbb; font-size:0.97rem; text-align:center;">
            Enter a URL above to browse anonymously via your Pi.
          </div>
        </div>
      </div>

      <div class="card">
        <h2>Samba Share</h2>
        <p>Windows network share path for downloads.</p>
        <div class="mono" id="smbPath">calculating...</div>
        <p class="small" style="margin-top:4px; color:var(--accent2);">User: dietpi / Pass: dietpi</p>
        <div class="row">
          <button class="btn warn copy" onclick="copySmb()">Copy Path</button>
          <span id="copyStatus" style="align-self:center;color:var(--muted)"></span>
        </div>
        <p style="margin-top:8px;color:var(--muted)">Tip: Press Win+R, paste the path, hit Enter.</p>
      </div>

      <div class="card">
        <h2>System Maintenance</h2>
          <div style="display: flex; flex-direction: column; gap: 12px;">
            <div>
              <button class="btn" id="updateSystemBtn" onclick="updateSystem()">Update System</button>
              <span id="updateStatus" class="small"></span>
              <div id="systemVersion"></div>
            </div>
            <div style="display: flex; align-items: center; gap: 10px;">
              <label class="switch">
                <input type="checkbox" id="logTmpfsToggle" onchange="toggleLogTmpfs(event)">
                <span class="slider"></span>
              </label>
              <span class="log-tmpfs-label">Log to RAM (tmpfs)</span>
              <span id="logTmpfsStatus" class="small"></span>
            </div>
            <div>
              <button class="btn warn" id="clearLogsBtn" onclick="clearLogs()">Clear Logs</button>
              <span id="clearLogsStatus" class="small"></span>
            </div>
          </div>
      </div>

      <div class="card">
        <h2>‚ú® Features</h2>
        <ul style="list-style:none; padding:0; margin:0; font-size:0.9rem; color:var(--muted);">
          <li style="margin-bottom:8px;">‚¨áÔ∏è <strong style="color:var(--text)">Aria2 Downloader</strong> - High-performance download manager with web UI</li>
          <li style="margin-bottom:8px;">üîí <strong style="color:var(--text)">VPN/Proxy Support</strong> - Mihomo (Clash Meta) for secure routing</li>
          <li style="margin-bottom:8px;">üåê <strong style="color:var(--text)">PHP-Proxy</strong> - Simple web proxy for privacy and bypassing restrictions</li>
          <li style="margin-bottom:8px;">üìÇ <strong style="color:var(--text)">Samba File Sharing</strong> - Access downloads from any device on your network</li>
          <li>üöÄ <strong style="color:var(--text)">Infrastructure as Code</strong> - Complete PC-to-Pi deployment workflow</li>
        </ul>
      </div>
    </section>

    <footer>
      <div style="display:flex; align-items:center; justify-content:center; gap:16px; flex-wrap:wrap;">
        <span id="projectVersion"></span>
        <a class="btn github" href="https://github.com/lishuren/DietPi-NanoPi" target="_blank" rel="noopener" style="font-size:0.9rem; padding:8px 12px;">
          <svg class="icon" viewBox="0 0 24 24" style="width:16px;height:16px"><path d="M12 0c-6.626 0-12 5.373-12 12 0 5.302 3.438 9.8 8.207 11.387.599.111.793-.261.793-.577v-2.234c-3.338.726-4.033-1.416-4.033-1.416-.546-1.387-1.333-1.756-1.333-1.756-1.089-.745.083-.729.083-.729 1.205.084 1.839 1.237 1.839 1.237 1.07 1.834 2.807 1.304 3.492.997.107-.775.418-1.305.762-1.604-2.665-.305-5.467-1.334-5.467-5.931 0-1.311.469-2.381 1.236-3.221-.124-.303-.535-1.524.117-3.176 0 0 1.008-.322 3.301 1.23.957-.266 1.983-.399 3.003-.404 1.02.005 2.047.138 3.006.404 2.291-1.552 3.297-1.23 3.297-1.23.653 1.653.242 2.874.118 3.176.77.84 1.235 1.911 1.235 3.221 0 4.609-2.807 5.624-5.479 5.921.43.372.823 1.102.823 2.222v3.293c0 .319.192.694.801.576 4.765-1.589 8.199-6.086 8.199-11.386 0-6.627-5.373-12-12-12z"/></svg>
          Open GitHub
        </a>
      </div>
    </footer>
  </div>
</body>
<!--
Notes:
- VPN UI lives at /var/www/html/vpn.php from install_vpn_web_ui.sh
- Samba share path defaults to \\HOST\downloads (HOST resolves via location.hostname)
-->
